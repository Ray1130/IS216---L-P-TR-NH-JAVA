<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.w3.org/1999/xhtml">
<link rel="stylesheet" href="/css/styleDKGD.css">


<head>
  <meta charset="UTF-8">
  <title>Danh sách lớp dạy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>

        .user-dropdown-wrapper {
          margin-left: auto; 
          position: relative;
          display: flex;
          align-items: center; 
        }

        .user-info-trigger {
          cursor: pointer;
          display: flex;
          align-items: center;
          padding: 8px 12px;
          border-radius: 4px;
          transition: background-color 0.2s ease-in-out;
          font-weight: 500;
          font-size: 16px;
          color: #000;
        }

        .user-info-trigger:hover {
          background-color: #e9ecef; 
        }

        .username-display {
          margin-right: 8px; 
        }

        .user-caret-icon {
          font-size: 0.9em; 
          transition: transform 0.2s ease-in-out; 
        }

        .dropdown-content-simple {
          display: none;      
          position: absolute; 
          background-color: white;
          min-width: 160px; 
          box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.15);
          z-index: 1001; 
          right: 0; 
          top: calc(100% + 5px); 
          border: 1px solid #ddd;
          border-radius: 4px;
          overflow: hidden;
        }

        .dropdown-item-simple.logout-button-simple {
          display: block; 
          width: 100%;
          padding: 10px 15px;
          text-align: left; 
          background-color: transparent;
          border: none;
          color: #333;
          font-size: 14px;
          cursor: pointer;
          font-family: inherit; 
        }

        .dropdown-item-simple.logout-button-simple:hover {
          background-color: #f0f0f0; 
          color: #0056b3; 
        }

        .btn-remove {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: 0.2s;
            align-items: center;
            justify-content: center;
        }

        .sidebar .fas,
        .sidebar .fa-solid {
            margin-right: 12px;
            font-size: 18px;
            color: #eeeff3;
        }

        .search-bar {
            top: 90px;
            left: 250px;
            right: 0;
            z-index: 9;
            display: flex;
            justify-content: center;

            align-items: center;
            padding: 8px 0px;
            gap: 15px;
            background-color: transparent;
            border-bottom: 1px solid #ccc;
            margin-bottom: 0px;
        }

        .input-icon {
            position: relative;
        }

        .input-icon input {
            padding: 6px 40px 6px 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            outline: none;
            font-size: 14px;
        }

        .input-icon i {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            pointer-events: none;
        }

        .search-bar input {
            width: 300px;
            height: 20px;
            padding: 8px;
            font-size: 13px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: #ffffff;
        }

        .search-bar button {
            background-color: #32548e;
            color: #e8edf3;
            font-size: 15px;
            font-weight: bold;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            min-width: 100px;
            cursor: pointer;
        }

        .search-bar button:hover {
            background-color: #3d5fab;
        }

        .table-container {
            max-height: 700px;
            overflow-y: auto;
            border: none;
            box-shadow: none;
        }

        .search-btn {
            background-color: #ef2e15;
            color: white;
            font-weight: bold;
            border: none;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
        }

        .search-btn:hover {
            background-color: #73b3f7;
        }

        .btn-remove {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: 0.2s;
            align-items: center;
            justify-content: center;
        }

        .btn-edit {
            background-color: #6990c8;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: 0.2s;
        }

      .btn-student-list {
    background-color: #3498db; 
    color: white;
    border: none;
    border-radius: 6px;
    padding: 6px 10px;
    font-size: 14px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s;
    text-decoration: none;
}

.btn-student-list i {
    font-size: 16px;
}

.btn-student-list:hover {
    background-color: #2980b9;
}

  </style>
</head>

<body>

<nav>

        <button class="tab-btn">
          <a th:href="@{/lecturer/dashboarddkgd}" style="text-decoration: none; color: inherit;">Dashboard</a>
        </button>
        <button class="tab-btn">
          <a th:href="@{/lecturer/dangkymonday}" style="text-decoration: none; color: inherit;">Đăng ký môn dạy</a>
        </button>
        <button class="tab-btn">
          <a th:href="@{/lecturer/dangkylichday}" style="text-decoration: none; color: inherit;">Đăng ký lịch dạy</a>
        </button>
        <button class="tab-btn">
          <a th:href="@{/lecturer/danhsachdkgd}" style="text-decoration: none; color: inherit;">Xem môn, lịch đã đăng ký</a>
        </button>
        <button class="tab-btn active">
          <a th:href="@{/lecturer/danhsachphancong}" style="text-decoration: none; color: inherit;">Danh sách lớp dạy</a>
        </button>

        <div class="user-dropdown-wrapper">
          <div id="userInfoTrigger" class="user-info-trigger">
            <span th:text="${#authentication.name ?: 'Người dùng'}" class="username-display">Tên Người Dùng</span>
            <i class="fas fa-caret-down user-caret-icon"></i> 
          </div>

          <div id="userDropdownContent" class="dropdown-content-simple">
            <form th:action="@{/logout}" method="post" style="margin:0;">
              <button type="submit" class="dropdown-item-simple logout-button-simple">Đăng xuất</button>
            </form>
          </div>
        </div>

</nav>


<form class="search-bar" method="get" th:action="@{/lecturer/danhsachphancong}">
    <div class="input-icon">
        <input type="text" name="maLop" placeholder="Mã lớp học" th:value="${maLop}">
        <i class="fa fa-search"></i>
    </div>
    <div class="input-icon">
        <input type="text" name="tenMH" placeholder="Tên môn học" th:value="${tenMH}">
        <i class="fa fa-search"></i>
    </div>

    <button type="submit" class="search-btn">Tìm kiếm</button>
    <a th:href="@{/lecturer/danhsachphancong}" class="search-btn" style="background-color: gray; text-decoration: none;">Hiển
        thị tất cả</a>
</form>

<div class="content">
    <div class="table-container">
      <table>
        <thead>
        <tr>
          <th>Mã lớp</th>
          <th>Môn học</th>
          <th>Số TC</th>
          <th>Mô tả</th>
          <th>Sĩ số</th>
          <th>Danh sách</th>
        </tr>
        </thead>
        <tbody>

            <tr th:each="hp : ${lopHocList}" th:data-ma-lop="${hp.MaLop}" th:data-ma-mh="${hp.MaMH}"
                th:data-ten-mh="${hp.TenMH}" th:data-so-tin-chi="${hp.SoTinChi}"
                th:data-thu-ngay-hoc="${hp.ThuNgayHoc}"
                th:data-tiet-hoc="${hp.TietHoc}" th:data-cach-tuan="${hp.CachTuan}" th:data-mahk="${hp.MaHK}"
                th:data-phongohc="${hp.PhongHoc}" th:data-ngay-bat-dau="${hp.NgayBatDau}"
                th:data-ngay-ket-thuc="${hp.NgayKetThuc}" th:data-si-so="${hp.SiSo}">
              <td th:text="${hp.MaLop}"></td>
              <td th:text="${hp.MaMH + ' - ' + hp.TenMH}"></td>
              <td th:text="${hp.SoTinChi}"></td>
              <td th:text="${'Thứ '+ hp.ThuNgayHoc + ', Tiết ' + hp.TietHoc + ', Cách ' + hp.CachTuan + ' tuần, ' + hp.NgayBatDau + ' - ' + hp.NgayKetThuc + ', Phòng học: '+ hp.PhongHoc}"></td>
              <td class="siso" th:data-ma-lop="${hp.MaLop}" th:text="${'0 / ' + hp.SiSo}"></td>
                <td>
                    <a th:href="@{'/lecturer/danhsachphancong/dssvOfGV/' + ${hp.MaLop}}" class="btn-student-list">
                        <i class="fas fa-bars"></i> 
                    </a>
                </td>

        </tbody>
      </table>
    </div>

    <div th:if="${lopHocList == null or #lists.isEmpty(lopHocList)}" style="text-align: center; padding: 20px;">
        Không có lớp học phần nào để hiển thị.
    </div>
</div>

</body>
</html>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  const trigger = document.getElementById('userInfoTrigger');
  const dropdownMenu = document.getElementById('userDropdownContent');

  if (trigger && dropdownMenu) {
      trigger.addEventListener('click', function (event) {
          event.stopPropagation();
          dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
      });

      document.addEventListener('click', function (event) {
          if (dropdownMenu.style.display === 'block' && !trigger.contains(event.target) && !dropdownMenu.contains(event.target)) {
              dropdownMenu.style.display = 'none';
          }
      });

      document.addEventListener('keydown', function(event) {
          if (event.key === 'Escape' && dropdownMenu.style.display === 'block') {
              dropdownMenu.style.display = 'none';
          }
      });
  }
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const rows = document.querySelectorAll(".siso");

      rows.forEach(row => {
          const maLop = row.getAttribute("data-ma-lop");
          fetch(`/DKHP/${maLop}/siso`)
              .then(response => response.json())
              .then(data => {
                  const siSoToiDa = row.textContent.split("/")[1].trim(); 
                  row.textContent = `${data} / ${siSoToiDa}`; 
              })
              .catch(error => {
                  console.error("Lỗi khi lấy số lượng đăng ký:", error);
                  row.textContent = `0 / ${row.textContent.split("/")[1].trim()}`; 
              });
      });
  });
</script>
